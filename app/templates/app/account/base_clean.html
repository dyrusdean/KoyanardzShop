{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Koya Nardz Computer Trading{% endblock %}</title>
    <style>
        /* Fallback font family in case Google Fonts timeout */
        body, html, * {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
        }
    </style>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <!-- Font Awesome v6.5.1 - Primary CDN (Cloudflare - Most Reliable) -->
    <link id="fontawesome-primary" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- FIX: Font Awesome CDN CSS missing font-family property, manually add it -->
    <style>
        /* Apply Font Awesome font-family to all icon variants */
        .fa:before,
        .fa::before,
        .fab:before,
        .fab::before,
        .fal:before,
        .fal::before,
        .far:before,
        .far::before,
        .fas:before,
        .fas::before,
        .fat:before,
        .fat::before,
        .fad:before,
        .fad::before,
        .fa-solid:before,
        .fa-solid::before,
        .fa-regular:before,
        .fa-regular::before,
        .fa-light:before,
        .fa-light::before,
        .fa-thin:before,
        .fa-thin::before,
        .fa-duotone:before,
        .fa-duotone::before,
        .fa-brands:before,
        .fa-brands::before,
        [class^="fa-"]:before,
        [class*=" fa-"]:before,
        [class^="fa-"]::before,
        [class*=" fa-"]::before {
            font-family: 'Font Awesome 6 Free' !important;
        }
        
        .fa-solid::before,
        .fas::before,
        .fa-solid:before,
        .fas:before {
            font-family: 'Font Awesome 6 Free' !important;
            font-weight: 900 !important;
        }
        
        .fa-regular::before,
        .far::before,
        .fa-regular:before,
        .far:before {
            font-family: 'Font Awesome 6 Free' !important;
            font-weight: 400 !important;
        }
        
        .fa-light::before,
        .fal::before,
        .fa-light:before,
        .fal:before {
            font-family: 'Font Awesome 6 Free' !important;
            font-weight: 300 !important;
        }
        
        .fa-thin::before,
        .fat::before,
        .fa-thin:before,
        .fat:before {
            font-family: 'Font Awesome 6 Free' !important;
            font-weight: 100 !important;
        }
        
        .fa-brands::before,
        .fab::before,
        .fa-brands:before,
        .fab:before {
            font-family: 'Font Awesome 6 Brands' !important;
            font-weight: 400 !important;
        }
        
        .fa-duotone::before,
        .fad::before,
        .fa-duotone:before,
        .fad:before {
            font-family: 'Font Awesome 6 Duotone' !important;
            font-weight: 900 !important;
        }
        
        /* Ensure icons are visible */
        i[class*="fa-"], 
        .fa, 
        .fa-solid, 
        .fa-regular, 
        .fa-light, 
        .fa-thin, 
        .fa-duotone,
        .fa-brands {
            display: inline-block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
    </style>
    <script>
        console.log('=== Font Awesome Loading Debug Started ===');
        
        // Font Awesome CDN Fallback System - Multiple CDN Options
        (function() {
            const cdnOptions = [
                'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css', // Primary
                'https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css', // Secondary
                'https://use.fontawesome.com/releases/v6.5.1/css/all.css' // Tertiary
            ];
            
            let cdnIndex = 0;
            let cdnTested = false;
            
            function inspectCSSRules() {
                console.log('üîç Inspecting CSS rules that apply to .fa-solid::before');
                for (let i = 0; i < document.styleSheets.length; i++) {
                    try {
                        const sheet = document.styleSheets[i];
                        if (!sheet.href || (!sheet.href.includes('font-awesome') && !sheet.href.includes('fontawesome'))) {
                            continue;
                        }
                        
                        console.log('üìã Stylesheet:', sheet.href);
                        
                        for (let j = 0; j < sheet.cssRules.length; j++) {
                            const rule = sheet.cssRules[j];
                            
                            // Look for rules that match .fa-solid or .fa or similar
                            if (rule.selectorText && (
                                rule.selectorText.includes('.fa-solid') || 
                                rule.selectorText.includes('::before') ||
                                rule.selectorText === '.fa' ||
                                rule.selectorText === '[class*="fa-"]'
                            )) {
                                console.log('  Selector:', rule.selectorText);
                                console.log('    Font-family:', rule.style.fontFamily || 'NOT SET');
                                console.log('    Content:', rule.style.content || 'NOT SET');
                                console.log('    Display:', rule.style.display || 'NOT SET');
                                
                                // Show all properties
                                if (rule.style.length > 0) {
                                    for (let k = 0; k < Math.min(10, rule.style.length); k++) {
                                        const prop = rule.style[k];
                                        console.log(`      ${prop}: ${rule.style.getPropertyValue(prop)}`);
                                    }
                                }
                            }
                        }
                    } catch (e) {
                        // Skip cross-origin stylesheets
                    }
                }
            }
            
            function checkStyleSheet() {
                console.log('üîç Checking loaded stylesheets...');
                for (let i = 0; i < document.styleSheets.length; i++) {
                    try {
                        const sheet = document.styleSheets[i];
                        if (sheet.href && (sheet.href.includes('font-awesome') || sheet.href.includes('fontawesome'))) {
                            console.log('‚úì Found Font Awesome stylesheet:', sheet.href);
                            console.log('  Total rules:', sheet.cssRules.length);
                        }
                    } catch (e) {
                        if (document.styleSheets[i].href) {
                            console.log('‚ö†Ô∏è  Can\'t access rules from:', document.styleSheets[i].href, '(CORS restricted)');
                        }
                    }
                }
            }
            
            function logIcons() {
                const icons = document.querySelectorAll('[class*="fa-"]');
                console.log('üìç Total icon elements found:', icons.length);
                if (icons.length > 0) {
                    console.log('üìç First 3 icons with full style inspection:');
                    Array.from(icons).slice(0, 3).forEach((icon, i) => {
                        const computed = window.getComputedStyle(icon, ':before');
                        console.log(`\n  [${i}] Element:`, icon.outerHTML.substring(0, 100));
                        console.log(`      Class: ${icon.className}`);
                        console.log(`      Computed ::before styles:`);
                        console.log(`        - content: ${computed.content}`);
                        console.log(`        - font-family: ${computed.fontFamily}`);
                        console.log(`        - font-weight: ${computed.fontWeight}`);
                        console.log(`        - font-size: ${computed.fontSize}`);
                        console.log(`        - display: ${computed.display}`);
                        
                        // Try to detect the actual computed font
                        const fontFamily = computed.fontFamily;
                        const hasAwesome = fontFamily.toLowerCase().includes('awesome');
                        console.log(`        - ‚úì Has Font Awesome font? ${hasAwesome}`);
                    });
                }
            }
            
            function testFontAwesome() {
                console.log('üîç Testing Font Awesome (attempt ' + (cdnIndex + 1) + ')...');
                if (cdnTested) {
                    console.log('‚ö†Ô∏è  Already tested, skipping');
                    return;
                }
                cdnTested = true;
                
                try {
                    // Check stylesheets first
                    checkStyleSheet();
                    
                    // Inspect CSS rules
                    inspectCSSRules();
                    
                    // Test with fa-solid format (what you're actually using)
                    const testDiv = document.createElement('div');
                    testDiv.className = 'fa-solid fa-check';
                    testDiv.style.display = 'inline-block';
                    testDiv.style.visibility = 'visible';
                    testDiv.id = 'fa-test-element';
                    document.body.appendChild(testDiv);
                    
                    console.log('\nüìù Test element created with class: fa-solid fa-check');
                    console.log('   HTML:', testDiv.outerHTML);
                    
                    const computed = window.getComputedStyle(testDiv, ':before');
                    const content = computed.content || computed.getPropertyValue('content');
                    const fontFamily = computed.fontFamily || computed.getPropertyValue('font-family');
                    const fontSize = computed.fontSize;
                    const display = computed.display;
                    const fontWeight = computed.fontWeight;
                    
                    console.log('\nüîé Test element pseudo-element (::before) computed styles:');
                    console.log('   - Content:', JSON.stringify(content));
                    console.log('   - Font-family:', fontFamily);
                    console.log('   - Font-weight:', fontWeight);
                    console.log('   - Font-size:', fontSize);
                    console.log('   - Display:', display);
                    
                    // Check if Font Awesome is applied
                    const isFontAwesome = fontFamily.toLowerCase().includes('awesome') || 
                                         fontFamily.toLowerCase().includes('fontawesome');
                    
                    console.log('\nüí° Analysis:');
                    console.log('   - Font Awesome font applied?', isFontAwesome ? '‚úÖ YES' : '‚ùå NO');
                    console.log('   - Content has glyph?', (content && content !== '""' && content !== 'none') ? '‚úÖ YES' : '‚ùå NO');
                    
                    if (!isFontAwesome) {
                        console.log('\nüö® PROBLEM: CSS selectors for .fa-solid::before are NOT applying font-family!');
                        console.log('   This means the Font Awesome CSS rules are not matching the selectors.');
                    }
                    
                    document.body.removeChild(testDiv);
                    
                    // Log actual icons on page
                    setTimeout(() => {
                        logIcons();
                    }, 100);
                    
                    return isFontAwesome;
                } catch(e) {
                    console.error('üí• Font Awesome detection error:', e);
                    console.error('Stack:', e.stack);
                    return false;
                }
            }
            
            function loadFallback() {
                cdnIndex++;
                if (cdnIndex >= cdnOptions.length) {
                    console.error('\n‚ùå All Font Awesome CDN options failed!');
                    console.error('üî¥ Probable cause: CSS selectors in Font Awesome CSS do not match .fa-solid format');
                    console.error('   Font files are loading but ::before pseudo-element styles not applied');
                    return;
                }
                
                console.log('\nüîó Loading Font Awesome CDN #' + (cdnIndex + 1) + ':', cdnOptions[cdnIndex]);
                const fallbackLink = document.createElement('link');
                fallbackLink.rel = 'stylesheet';
                fallbackLink.href = cdnOptions[cdnIndex];
                fallbackLink.crossOrigin = 'anonymous';
                fallbackLink.referrerPolicy = 'no-referrer';
                fallbackLink.onload = function() {
                    console.log('‚ú® Fallback CDN #' + (cdnIndex + 1) + ' loaded! Testing...');
                    cdnTested = false;
                    setTimeout(() => testFontAwesome(), 500);
                };
                fallbackLink.onerror = function() {
                    console.error('‚ùå Failed to load fallback CDN #' + (cdnIndex + 1));
                    loadFallback();
                };
                document.head.appendChild(fallbackLink);
            }
            
            // Initial log
            console.log('üì¶ Available CDN options:');
            cdnOptions.forEach((url, i) => console.log(`  [${i + 1}] ${url}`));
            
            // Test after 1 second
            setTimeout(() => {
                console.log('\n‚è±Ô∏è  1 second timeout - Testing Font Awesome...\n');
                if (!testFontAwesome()) {
                    console.log('\nüìç Primary CDN failed, trying fallbacks...');
                    loadFallback();
                }
            }, 1000);
            
            console.log('=== Font Awesome Debug Script Initialized ===');
        })();
    </script>
            
            // Force test after 3 seconds as backup
            setTimeout(() => {
                if (!cdnTested) {
                    testFontAwesome();
                }
            }, 3000);
        })();
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Afacad:ital,wght@0,400..700;1,400..700&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Quicksand:wght@300..700&display=swap" rel="stylesheet">
    {% block extra_css %}{% endblock %}
</head>
<body>
    <main class="content-wrapper" style="background-color: whitesmoke;">
        {% block content %}{% endblock %}
    </main>

    <script src="{% static 'js/base.js' %}?v=2.1"></script>
    {% block extra_js %}{% endblock %}
</body>
</html>
